# Nginx HTTP/3 Docker Image Builder

This project contains a Dockerfile that builds a custom nginx Docker image with HTTP/3 support, along with a comprehensive test environment.

## Features

- Builds nginx version 1.26.1 (configurable via ENV variable)
- Includes HTTP/3 (QUIC) support
- Uses BoringSSL (Google's SSL library with native QUIC support)
- Includes common modules like SSL, HTTP/2, and streaming
- Optimized for a minimal, production-ready image
- Includes a test environment with:
  - Go service for testing HTTP functionalities
  - WebSocket support
  - File upload/download capabilities
  - Traffic analysis tools

## Project Structure

```
.
├── Dockerfile              # Main nginx image build configuration
├── README.md              # This file
├── setup-ssl.sh           # SSL certificate setup script
├── default.conf           # Default nginx configuration
├── certs/                 # SSL certificates directory (generated by ./setup-ssl.sh)
└── test/                  # Test environment
    ├── README.md         # Test environment documentation
    ├── docker-compose.yml # Test services configuration
    ├── hello-service/    # Go test service
    └── nginx/            # Nginx test configuration
```

## Requirements

- Docker
- Docker Compose V2 (for test environment)
- SSL certificates (for HTTPS/HTTP3 testing)

## Usage

### Build the Docker image

```bash
docker build -t nginx-http3 .
```

### Run the container

```bash
docker run -d \
  --name nginx-http3-server \
  -p 80:80 \
  -p 443:443 \
  -p 443:443/udp \
  -v /path/to/nginx.conf:/etc/nginx/nginx.conf:ro \
  -v /path/to/conf.d:/etc/nginx/conf.d:ro \
  -v /path/to/certs:/etc/nginx/certs:ro \
  nginx-http3
```

### Verify the container

```bash
# Check container status
docker ps

# Check nginx version and configuration
docker exec nginx-http3-server nginx -v
docker exec nginx-http3-server nginx -t
```

## Test Environment

The project includes a comprehensive test environment located in the `test/` directory. To use it:

1. Navigate to the test directory:
   ```bash
   cd test
   ```

2. Start the test environment:
   ```bash
   docker compose up --build
   ```

3. Access the test services:
   - HTTP: http://localhost
   - HTTPS/HTTP3: https://localhost
   - WebSocket test page: http://localhost/ws-test

For detailed information about the test environment, including available endpoints and traffic analysis, see [test/README.md](test/README.md).

## HTTP/3 Configuration

To use HTTP/3 in your nginx configuration, you need to:

1. Add the `http3` parameter to the listen directive:
   ```
   listen 443 ssl http3;
   ```

2. Enable QUIC and HTTP/3 transport for HTTPS:
   ```
   listen 443 quic reuseport;
   http3 on;
   ```

3. Add the Alt-Svc header to inform clients of HTTP/3 support:
   ```
   add_header Alt-Svc 'h3=":443"; ma=86400';
   ```

4. Configure SSL settings for optimal HTTP/3 performance:
   ```
   ssl_session_cache shared:SSL:10m;
   ssl_session_timeout 10m;
   ssl_protocols TLSv1.2 TLSv1.3;
   ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
   ```

## Customization

You can modify the Dockerfile to:

1. Change the nginx version by updating the `NGINX_VERSION` environment variable
2. Add or remove compile options in the `./configure` step
3. Include additional dependencies or modules
4. Modify build optimization flags

## Testing HTTP/3 Support

To verify HTTP/3 support:

1. Use curl with HTTP/3 support:
   ```bash
   curl --http3 https://localhost/api/
   ```

2. Check the Alt-Svc header in responses:
   ```bash
   curl -I https://localhost/api/
   ```

3. Use Chrome or Edge browser to test HTTP/3 connections (they support HTTP/3 by default)

## License

The nginx source code is subject to the [BSD-like license](https://nginx.org/LICENSE) used by the nginx project. 